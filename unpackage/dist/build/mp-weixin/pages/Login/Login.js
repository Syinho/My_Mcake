(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/Login/Login"],{"1bcd":function(e,t,n){},"25af":function(e,t,n){"use strict";n.d(t,"b",(function(){return r})),n.d(t,"c",(function(){return a})),n.d(t,"a",(function(){return o}));var o={uTransition:function(){return Promise.all([n.e("common/vendor"),n.e("uni_modules/uview-ui/components/u-transition/u-transition")]).then(n.bind(null,"2c52"))},"u-Input":function(){return Promise.all([n.e("common/vendor"),n.e("uni_modules/uview-ui/components/u--input/u--input")]).then(n.bind(null,"dc69"))},uLine:function(){return Promise.all([n.e("common/vendor"),n.e("uni_modules/uview-ui/components/u-line/u-line")]).then(n.bind(null,"5ac5"))},uIcon:function(){return Promise.all([n.e("common/vendor"),n.e("uni_modules/uview-ui/components/u-icon/u-icon")]).then(n.bind(null,"5b08"))},uToast:function(){return n.e("uni_modules/uview-ui/components/u-toast/u-toast").then(n.bind(null,"472c"))},uLoadingPage:function(){return Promise.all([n.e("common/vendor"),n.e("uni_modules/uview-ui/components/u-loading-page/u-loading-page")]).then(n.bind(null,"f837"))},uNotify:function(){return Promise.all([n.e("common/vendor"),n.e("uni_modules/uview-ui/components/u-notify/u-notify")]).then(n.bind(null,"931c"))}},r=function(){var e=this.$createElement;this._self._c},a=[]},"370f":function(e,t,n){"use strict";n.r(t);var o=n("25af"),r=n("ec69");for(var a in r)["default"].indexOf(a)<0&&function(e){n.d(t,e,(function(){return r[e]}))}(a);n("3e34");var u=n("f0c5"),i=Object(u["a"])(r["default"],o["b"],o["c"],!1,null,null,null,!1,o["a"],void 0);t["default"]=i.exports},"3e34":function(e,t,n){"use strict";var o=n("1bcd"),r=n.n(o);r.a},6735:function(e,t,n){"use strict";(function(e,t){var o=n("4ea4");n("0720");o(n("66fd"));var r=o(n("370f"));e.__webpack_require_UNI_MP_PLUGIN__=n,t(r.default)}).call(this,n("bc2e")["default"],n("543d")["createPage"])},b77e:function(e,t,n){"use strict";(function(e){var o=n("4ea4");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=o(n("2eee")),a=o(n("c973")),u=o(n("9523")),i=n("1faf"),c=n("26cb"),s=o(n("8615"));function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function d(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){(0,u.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var f={name:"login",data:function(){return{TabCur:0,phone:"",captcha:"",code:"",captchaSrc:"",password:"",isShowLoading:!1,beAllowedToGetSMS:!0,getSMSBtnText:"点击获取验证码",timer:null}},computed:d(d({},(0,c.mapState)({isLogin:function(e){return e.user.isLogin},cartList:function(e){return e.shopCart.cartList}})),{},{captchaStyle:function(){return{backgroundImage:"url('".concat(this.captchaSrc,"')")}}}),created:function(){this.updateCode()},onLoad:function(t){this.isLogin&&e.switchTab({url:"/pages/profile/profile"}),console.log(t)},methods:d(d(d(d(d(d({},(0,c.mapMutations)("user",["updatePhone","updateToken"])),(0,c.mapMutations)("profile",["toggleLoginSuccessToast"])),(0,c.mapMutations)("shopCart",["reWriteCartList"])),(0,c.mapActions)("user",["loginAndStorageUserData"])),(0,c.mapActions)("shopCart",["getShopCart"])),{},{tabSelect:function(e){var t=Number(e.currentTarget.dataset.id);this.TabCur!==t&&(0===this.TabCur?this.phone=this.captcha=this.code="":this.phone=this.password="",this.TabCur=t)},updateCode:function(){var e=this;return(0,a.default)(r.default.mark((function t(){var n,o,a,u,c;return r.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,(0,i.reqImgCaptcha)().catch((function(e){return e}));case 2:n=t.sent,1===n.code&&(o=n.data,a=o.img,u=o.text,c=/#/g,e.captchaSrc="data:image/svg+xml;utf8,"+a.replace(c,"%23"),e.captchaText=u,console.log("%c login页面:updateCode函数向服务器发起请求获取到Captcha值为:","padding:5px 2px;color:yellow;background-color:#228B22;"),console.log(u));case 4:case"end":return t.stop()}}),t)})))()},goToRegister:function(){this.$switchPage({pageName:"Register"})},getCode:function(){var e=this;return(0,a.default)(r.default.mark((function t(){var n,o,a,u;return r.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!e.beAllowedToGetSMS){t.next=10;break}return e.beAllowedToGetSMS=!1,e.getSMSBtnText="倒计时10秒",n=10,e.timer=setInterval((function(){if(1===n)return e.updateCode(),clearInterval(e.timer),e.timer=null,e.beAllowedToGetSMS=!0,void(e.getSMSBtnText="点击获取验证码");n--,e.getSMSBtnText="倒计时".concat(n,"秒")}),1e3),o=e.phone,a=e.captcha,t.next=8,(0,i.reqTextCode)(o,a).catch((function(e){return e}));case 8:u=t.sent,1===u.code?console.log(u.msg):(e.updateCode(),e.$notify("error",u.msg));case 10:case"end":return t.stop()}}),t)})))()},login:function(e){var t=this;return(0,a.default)(r.default.mark((function n(){var o,a,u,c,l,d,f,p,g,h,m;return r.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(t.isShowLoading=!0,0!==e){n.next=31;break}return n.next=4,(0,i.reqLoginBySMS)(t.phone,t.code).catch((function(e){return e}));case 4:if(o=n.sent,1!==o.code){n.next=27;break}return a=o.data,u=a.token,c={type:"SMS"},Object.assign(a,c),c=null,t.$setStorage("token",u),t.loginAndStorageUserData(a),n.next=15,t.getShopCart().catch((function(e){return e}));case 15:if(l=n.sent,console.log(l),1!==l.code){n.next=21;break}t.reWriteCartList(l.data),n.next=23;break;case 21:return t.isShowLoading=!1,n.abrupt("return",t.$toast("error",l.msg));case 23:t.toggleLoginSuccessToast(!0),t.$switchPage({pageName:"Profile"}),n.next=29;break;case 27:t.isShowLoading=!1,t.$refs.uToast.show({type:"error",message:o.msg||"登录失败"});case 29:n.next=61;break;case 31:return d=t.phone,f=t.password,n.next=34,(0,i.reqLoginByPassword)(d,(0,s.default)(f)).catch((function(e){return e}));case 34:if(p=n.sent,console.log(p),1!==p.code){n.next=59;break}return console.log("通过密码登录成功"),g=p.data.token,h={type:"password"},Object.assign(p.data,h),h=null,t.$setStorage("token",g),t.loginAndStorageUserData(p.data),n.next=46,t.getShopCart().catch((function(e){return e}));case 46:if(m=n.sent,console.log(m),1!==m.code){n.next=52;break}t.reWriteCartList(m.data),n.next=54;break;case 52:return t.isShowLoading=!1,n.abrupt("return",t.$toast("error",m.msg));case 54:t.toggleLoginSuccessToast(!0),t.$switchPage({pageName:"Profile"}),console.log("end"),n.next=61;break;case 59:t.isShowLoading=!1,t.$refs.uToast.show({type:"error",message:p.msg||"登录失败"});case 61:case"end":return n.stop()}}),n)})))()}})};t.default=f}).call(this,n("543d")["default"])},ec69:function(e,t,n){"use strict";n.r(t);var o=n("b77e"),r=n.n(o);for(var a in o)["default"].indexOf(a)<0&&function(e){n.d(t,e,(function(){return o[e]}))}(a);t["default"]=r.a}},[["6735","common/runtime","common/vendor"]]]);