(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/Detail/Detail"],{"03f0":function(t,e,n){"use strict";(function(t){var a=n("4ea4");Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var r=a(n("2eee")),o=a(n("c973")),u=a(n("9523")),i=n("1faf"),c=n("26cb");function s(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,a)}return n}function d(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?s(Object(n),!0).forEach((function(e){(0,u.default)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var l={name:"UniappDemoDetails",data:function(){return{tabCur:2,goodDetail:["基本信息","商品点评","商品详情"],curCmtPage:1,preCmtPage:1,loading:!1,isShowCmtsErrCom:!1,isReqBtnAbled:!0,isShowModel:!1,loadingPage:{loading:!1,color:"#000",bgColor:"rgab(255,255,255,0.1)",iconSize:"80rpx",loadingColor:"#000",loadingText:""}}},computed:d(d(d({},(0,c.mapState)("detail",{goodData:function(t){return t.goodData},cmts:function(t){return t.cmts},cmtCounts:function(t){return t.cmtCounts}})),(0,c.mapState)("user",{isLogin:function(t){return t.isLogin},userId:function(t){return t.userId}})),{},{itemWidth:function(){var t=this.goodData.list;return 100/t.length+"%"},tagList:function(){return!!this.goodData.fname&&this.goodData.fname.split(",")},detailImgSrc:function(){if(/src="(\S+)"/.test(this.goodData.details))return RegExp.$1},commentPage:function(){return Math.ceil(this.cmtCounts/this.cmts.length)}}),watch:{curCmtPage:function(t,e){var n=this;return(0,o.default)(r.default.mark((function a(){var o,u,c,s;return r.default.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(t!==e){a.next=2;break}return a.abrupt("return");case 2:if(n.curCmtPage!==n.preCmtPage){a.next=4;break}return a.abrupt("return");case 4:return n.updateComments([{},{},{},{},{},{}]),n.loading=!0,a.next=8,n.chkAndGetToken().catch((function(t){return t}));case 8:if(o=a.sent,1!==o.code){a.next=18;break}return u=o.data["access-token"],a.next=13,(0,i.reqComment)(n.goodData.twoId,n.curCmtPage,u).catch((function(t){return t}));case 13:c=a.sent,console.log(c),1===c.code?(n.updateComments(c.data.list),n.loading=!1):(n.curCmtPage=n.preCmtPage,n.loading=!1,n.toast("errro","获取评论失败, 请检查服务器"),n.isShowCmtsErrCom=!0),a.next=21;break;case 18:n.curCmtPage=n.preCmtPage,s=o.msg,n.toast("error",s);case 21:case"end":return a.stop()}}),a)})))()}},onLoad:function(t){var e=this;return(0,o.default)(r.default.mark((function n(){var a,o,u,c,s;return r.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return a=t.id,n.next=3,e.chkAndGetToken().catch((function(t){return t}));case 3:if(o=n.sent,1!==o.code){n.next=22;break}return u=o.data["access-token"],n.next=8,(0,i.reqDetail)(a,u).catch((function(t){return t}));case 8:if(c=n.sent,1!==c.code){n.next=13;break}e.updateGoodData(c.data),n.next=16;break;case 13:return e.toast("error","获取商品数据失败, 检查服务器"),e.handleErr(),n.abrupt("return");case 16:return n.next=18,(0,i.reqComment)(e.goodData.twoId,1,u).catch((function(t){return t}));case 18:s=n.sent,1===s.code?(e.updateCmtsCounts(s.data.count),e.updateComments(s.data.list)):(e.toast("error","获取评论失败"),e.isShowCmtsErrCom=!0),n.next=24;break;case 22:e.toast("error","获取access-token失败, 检查网络连接或服务器"),e.handleErr();case 24:case"end":return n.stop()}}),n)})))()},onUnload:function(){console.log("detail onUnload"),this.updateGoodData({}),this.updateCmtsCounts(0),this.updateComments([])},methods:d(d(d(d({},(0,c.mapMutations)("detail",["updateGoodData","updateId","updatePrice","updateSize","updateFittings","updateComments","updateCmtsCounts"])),(0,c.mapActions)(["chkAndGetToken"])),(0,c.mapActions)("shopCart",["initShopCart"])),{},{switchItem:function(t){var e=t.currentTarget.dataset.id;console.log(e),e!=this.goodData.id&&(this.updateId(e),this.updatePrice(this.goodData.list.find((function(t){return t.id==e})).salePrice),this.updateSize(this.goodData.list.find((function(t){return t.id==e})).size),this.updateFittings(this.goodData.list.find((function(t){return t.id==e})).fittings))},tabSelect:function(t){this.tabCur=t.currentTarget.dataset.id},handleCmt:function(t){"substract"===t?this.preCmtPage=this.curCmtPage--:"add"===t?this.preCmtPage=this.curCmtPage++:"number"===typeof t&&(this.preCmtPage=this.curCmtPage,this.curCmtPage=t)},toast:function(t,e){this.$refs.uToast.show({title:e,type:t,url:"/pages/detail/detail"})},handleErr:function(){var t=this;setTimeout((function(){t.$switchPage({pageName:"Categorys"})}),1500)},reReqCmt:function(){},buy:function(){var t=this;return(0,o.default)(r.default.mark((function e(){var n,a;return r.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t.isLogin){e.next=2;break}return e.abrupt("return",t.isShowModel=!0);case 2:return t.loadingPage.loading=!0,e.next=5,t.addGoodsToShopCart();case 5:if(n=e.sent,1!==n.code){e.next=13;break}return e.next=9,t.initShopCart().catch((function(t){return t}));case 9:a=e.sent,1===a.code?t.$switchPage({pageName:"ShopCart"}):t.$toast("error",a.msg),e.next=14;break;case 13:t.$toast("error",n.msg);case 14:t.loadingPage.loading=!1;case 15:case"end":return e.stop()}}),e)})))()},putInCart:function(){var t=this;return(0,o.default)(r.default.mark((function e(){var n,a;return r.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t.isLogin||(t.isShowModel=!0),t.loadingPage.loading=!0,e.next=4,t.addGoodsToShopCart();case 4:if(n=e.sent,1===n.code){e.next=9;break}t.$toast("error",n.msg),e.next=13;break;case 9:return e.next=11,t.initShopCart().catch((function(t){return t}));case 11:a=e.sent,1===a.code||t.$toast("error",a.msg);case 13:t.loadingPage.loading=!1;case 14:case"end":return e.stop()}}),e)})))()},addGoodsToShopCart:function(){var t=this;return(0,o.default)(r.default.mark((function e(){var n,a,o;return r.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.chkAndGetToken().catch((function(t){return t}));case 2:if(n=e.sent,1!==n.code){e.next=11;break}return a=n.data["access-token"],e.next=7,(0,i.reqAddShopCart)(t.userId,t.goodData.id,t.goodData.count,a).catch((function(t){return t}));case 7:return o=e.sent,e.abrupt("return",o);case 11:t.$toast("error",n.msg);case 12:case"end":return e.stop()}}),e)})))()},findId:function(){},confirm:function(){t.navigateTo({url:"/pages/Login/Login"})},cancel:function(){this.isShowModel=!1}}),components:{comment:function(){n.e("components/comment/comment").then(function(){return resolve(n("bcd7"))}.bind(null,n)).catch(n.oe)}}};e.default=l}).call(this,n("543d")["default"])},"19ba":function(t,e,n){"use strict";(function(t,e){var a=n("4ea4");n("0720");a(n("66fd"));var r=a(n("28d4"));t.__webpack_require_UNI_MP_PLUGIN__=n,e(r.default)}).call(this,n("bc2e")["default"],n("543d")["createPage"])},"28d4":function(t,e,n){"use strict";n.r(e);var a=n("f01b"),r=n("8c3a");for(var o in r)["default"].indexOf(o)<0&&function(t){n.d(e,t,(function(){return r[t]}))}(o);n("3cb5");var u=n("f0c5"),i=Object(u["a"])(r["default"],a["b"],a["c"],!1,null,"61702937",null,!1,a["a"],void 0);e["default"]=i.exports},"3cb5":function(t,e,n){"use strict";var a=n("66d3"),r=n.n(a);r.a},"66d3":function(t,e,n){},"8c3a":function(t,e,n){"use strict";n.r(e);var a=n("03f0"),r=n.n(a);for(var o in a)["default"].indexOf(o)<0&&function(t){n.d(e,t,(function(){return a[t]}))}(o);e["default"]=r.a},f01b:function(t,e,n){"use strict";n.d(e,"b",(function(){return r})),n.d(e,"c",(function(){return o})),n.d(e,"a",(function(){return a}));var a={comment:function(){return n.e("components/comment/comment").then(n.bind(null,"bcd7"))},uRow:function(){return Promise.all([n.e("common/vendor"),n.e("uni_modules/uview-ui/components/u-row/u-row")]).then(n.bind(null,"aa21"))},uCol:function(){return Promise.all([n.e("common/vendor"),n.e("uni_modules/uview-ui/components/u-col/u-col")]).then(n.bind(null,"0fbc"))},uButton:function(){return Promise.all([n.e("common/vendor"),n.e("uni_modules/uview-ui/components/u-button/u-button")]).then(n.bind(null,"a348"))},uToast:function(){return n.e("uni_modules/uview-ui/components/u-toast/u-toast").then(n.bind(null,"472c"))},uModal:function(){return Promise.all([n.e("common/vendor"),n.e("uni_modules/uview-ui/components/u-modal/u-modal")]).then(n.bind(null,"c92c"))},uLoadingPage:function(){return Promise.all([n.e("common/vendor"),n.e("uni_modules/uview-ui/components/u-loading-page/u-loading-page")]).then(n.bind(null,"f837"))}},r=function(){var t=this,e=t.$createElement,n=(t._self._c,JSON.stringify(t.goodData)),a="{}"!==n?JSON.stringify(t.goodData):null,r="{}"!==n?"{}"===JSON.stringify(t.goodData.fittings)||0===t.goodData.fittings.length:null,o="{}"!==n?1===t.tabCur&&t.cmts.length>0:null,u="{}"!==n&&o?t.cmts.length:null;t.$mp.data=Object.assign({},{$root:{g0:n,g1:a,g2:r,g3:o,g4:u}})},o=[]}},[["19ba","common/runtime","common/vendor"]]]);