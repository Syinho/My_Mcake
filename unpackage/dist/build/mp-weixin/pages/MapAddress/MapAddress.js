(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/MapAddress/MapAddress"],{"227d":function(e,r,s){"use strict";s.r(r);var t=s("72e7"),n=s("fb55");for(var a in n)["default"].indexOf(a)<0&&function(e){s.d(r,e,(function(){return n[e]}))}(a);s("e24a");var d=s("f0c5"),i=Object(d["a"])(n["default"],t["b"],t["c"],!1,null,"a7f2ecb4",null,!1,t["a"],void 0);r["default"]=i.exports},"5bdb":function(e,r,s){"use strict";(function(e,r){var t=s("4ea4");s("0720");t(s("66fd"));var n=t(s("227d"));e.__webpack_require_UNI_MP_PLUGIN__=s,r(n.default)}).call(this,s("bc2e")["default"],s("543d")["createPage"])},"72e7":function(e,r,s){"use strict";s.d(r,"b",(function(){return n})),s.d(r,"c",(function(){return a})),s.d(r,"a",(function(){return t}));var t={"u-Form":function(){return Promise.all([s.e("common/vendor"),s.e("uni_modules/uview-ui/components/u--form/u--form")]).then(s.bind(null,"c20d"))},uFormItem:function(){return Promise.all([s.e("common/vendor"),s.e("uni_modules/uview-ui/components/u-form-item/u-form-item")]).then(s.bind(null,"56f1"))},"u-Input":function(){return Promise.all([s.e("common/vendor"),s.e("uni_modules/uview-ui/components/u--input/u--input")]).then(s.bind(null,"dc69"))},"u-Text":function(){return Promise.all([s.e("common/vendor"),s.e("uni_modules/uview-ui/components/u--text/u--text")]).then(s.bind(null,"206c"))},uIcon:function(){return Promise.all([s.e("common/vendor"),s.e("uni_modules/uview-ui/components/u-icon/u-icon")]).then(s.bind(null,"5b08"))},uCheckboxGroup:function(){return Promise.all([s.e("common/vendor"),s.e("uni_modules/uview-ui/components/u-checkbox-group/u-checkbox-group")]).then(s.bind(null,"d621"))},uCheckbox:function(){return Promise.all([s.e("common/vendor"),s.e("uni_modules/uview-ui/components/u-checkbox/u-checkbox")]).then(s.bind(null,"74b2"))},uButton:function(){return Promise.all([s.e("common/vendor"),s.e("uni_modules/uview-ui/components/u-button/u-button")]).then(s.bind(null,"a348"))},uNotify:function(){return Promise.all([s.e("common/vendor"),s.e("uni_modules/uview-ui/components/u-notify/u-notify")]).then(s.bind(null,"931c"))},uPicker:function(){return Promise.all([s.e("common/vendor"),s.e("uni_modules/uview-ui/components/u-picker/u-picker")]).then(s.bind(null,"5fcd"))},uPopup:function(){return Promise.all([s.e("common/vendor"),s.e("uni_modules/uview-ui/components/u-popup/u-popup")]).then(s.bind(null,"f6d0"))}},n=function(){var e=this.$createElement;this._self._c},a=[]},e24a:function(e,r,s){"use strict";var t=s("fca2"),n=s.n(t);n.a},e553:function(e,r,s){"use strict";(function(e){var t=s("4ea4");Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=t(s("2eee")),a=t(s("c973")),d=t(s("9523")),i=s("1faf"),u=s("26cb");function o(e,r){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);r&&(t=t.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),s.push.apply(s,t)}return s}function c(e){for(var r=1;r<arguments.length;r++){var s=null!=arguments[r]?arguments[r]:{};r%2?o(Object(s),!0).forEach((function(r){(0,d.default)(e,r,s[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):o(Object(s)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(s,r))}))}return e}var l={name:"UniappDemoMapAddress",data:function(){return{latitude:31.235929,longitude:121.480539,covers:[{latitude:39.909,longitude:116.39742},{latitude:39.9,longitude:116.39}],address:{name:"",phone:"",area:{isShowPicker:!1,text:"请选择区域",isShowPopup:!1,detail:"",houseNum:""},isDefault:!1,suggestAddress:[],isNoSuggest:!1,isAllowUseInputAddress:!1},leftIconStyle:{"font-size":"50rpx",color:"#ccc"},areas:"黄浦区、徐汇区、长宁区、静安区、普陀区、虹口区、杨浦区、浦东新区、闵行区、宝山区、嘉定区、金山区、松江区、青浦区、奉贤区、崇明区",searchTimer:null,searchWord:"",btnText:"以上都不是, 以当前输入为准"}},computed:c(c({},(0,u.mapState)("user",{isLogin:function(e){return e.isLogin},userId:function(e){return e.userId},modifiedAddress:function(e){return e.modifiedAddress}})),{},{columns:function(){for(var e=this.areas.split("、"),r=[],s=0;s<e.length;s++)r.push({name:e[s],index:s});return[r]}}),created:function(){if(console.log("mapAddress created"),"{}"!==JSON.stringify(this.modifiedAddress)){this.address.phone=this.modifiedAddress.phone,this.address.name=this.modifiedAddress.uname;var e=this.modifiedAddress.address.match(/^(\S+,\S+),(\S+)$/);this.address.area.detail=e[1],this.address.area.houseNum=e[2],this.address.isDefault="1"===this.modifiedAddress.isDefault;var r=this.modifiedAddress.address.match(/市(\S{2,4}区)/)[1];console.log(r),this.address.area.text=r,console.log(this.address)}},mounted:function(){e.hideTabBar({animation:!1})},watch:(0,d.default)({},"address.area.detail",(function(e,r){""===e&&(this.address.suggestAddress=[],this.searchTimer&&(clearTimeout(this.searchTimer),this.searchTimer=null))})),methods:c(c({},(0,u.mapMutations)("user",["reWriteAddress","reWriteBeUsedAddress","reWriteModifiedAddress","modifyAddressItem"])),{},{handlePicker:function(){this.address.area.isShowPicker=!0},pickerConfirm:function(e){this.address.area.text=e.value[0].name,this.address.area.isShowPicker=!1},pickerCancel:function(){this.address.area.isShowPicker=!1},pickerChange:function(e){this.address.area.detail=this.address.area.houseNum=""},submit:function(){var e=this;return(0,a.default)(n.default.mark((function r(){var s,t,a,d,u,o,c;return n.default.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(e.isLogin){r.next=2;break}return r.abrupt("return",e.$notify("error","未登录, 你怎么进来这个页面的??"));case 2:if(e.address.name){r.next=6;break}return r.abrupt("return",e.$notify("error","姓名不可为空"));case 6:if(s=/^[\w\u4e00-\u9fa5A]{1,11}$/,s.test(e.address.name)){r.next=9;break}return r.abrupt("return",e.$notify("error","姓名格式错误:1-11个非空字符"));case 9:if(e.address.phone){r.next=13;break}return r.abrupt("return",e.$notify("error","手机号不可为空"));case 13:if(t=/^\d{11}$/,t.test(e.address.phone)){r.next=16;break}return r.abrupt("return",e.$notify("error","手机号格式错误:11个数字"));case 16:if(e.address.area.text){r.next=18;break}return r.abrupt("return",e.$notify("error","请选择城市区域"));case 18:if(e.address.area.detail){r.next=20;break}return r.abrupt("return",e.$notify("error","请填写详细收获地址"));case 20:if(e.address.area.houseNum){r.next=22;break}return r.abrupt("return",e.$notify("error","请填写楼号,门牌号"));case 22:if(a={userId:e.userId,uname:e.address.name,phone:e.address.phone,address:e.address.area.detail+","+e.address.area.houseNum,isDefault:e.address.isDefault?"1":"0"},"{}"===JSON.stringify(e.modifiedAddress)){r.next=48;break}return a.id=e.modifiedAddress.id,r.next=27,(0,i.reqModifyAddress)(a);case 27:if(d=r.sent,1!==d.code){r.next=44;break}return r.next=31,(0,i.reqGetAllAddress)(e.userId).catch((function(e){return e}));case 31:if(u=r.sent,1!==u.code){r.next=38;break}if(0!==u.data.length){r.next=35;break}return r.abrupt("return");case 35:e.reWriteAddress(u.data),r.next=39;break;case 38:return r.abrupt("return",e.$notify("error",u.msg));case 39:e.reWriteBeUsedAddress(a),e.reWriteModifiedAddress({}),e.$switchPage({pageName:"Address"}),r.next=45;break;case 44:e.$notify("error",d.msg);case 45:return r.abrupt("return");case 48:return r.next=50,(0,i.reqStoreAddress)(a).catch((function(e){return e}));case 50:if(o=r.sent,1!==o.code){r.next=68;break}return console.log("添加地址成功"),r.next=55,(0,i.reqGetAllAddress)(e.userId).catch((function(e){return e}));case 55:if(c=r.sent,1!==c.code){r.next=62;break}if(0!==c.data.length){r.next=59;break}return r.abrupt("return");case 59:e.reWriteAddress(c.data),r.next=63;break;case 62:return r.abrupt("return",e.$notify("error",c.msg));case 63:Object.assign(a,{id:o.data.id}),e.reWriteBeUsedAddress(a),e.$switchPage({pageName:"OrderForm"}),r.next=69;break;case 68:return r.abrupt("return",console.log(o));case 69:case"end":return r.stop()}}),r)})))()},handleChkbox:function(){this.address.isDefault=!this.address.isDefault},showPopup:function(){this.address.area.isShowPopup=!0,this.address.area.detail&&(this.searchWord=this.address.area.detail,this.searchAddress(this.searchWord))},closePopup:function(){this.address.area.isShowPopup=!1,this.address.suggestAddress=[],this.isNoSuggest=!1,this.searchWord=""},searchAddress:function(e){var r=this;return(0,a.default)(n.default.mark((function s(){var t,a,d,u;return n.default.wrap((function(s){while(1)switch(s.prev=s.next){case 0:if(console.log(e),r.address.area.isShowPopup){s.next=3;break}return s.abrupt("return");case 3:if(r.searchWord=e,t="XBGBZ-FRMRJ-3V5FY-XHGXK-GWGT5-SQBXJ",a=e,""!==a){s.next=10;break}return r.address.suggestAddress=[],r.address.isAllowUseInputAddress=!1,s.abrupt("return");case 10:return d="上海市"+r.address.area.text,1,1,20,1,s.next=17,(0,i.reqSearchAddress)({key:t,keyword:a,region:d,region_fix:1,policy:1,page_size:20,page_index:1});case 17:if(u=s.sent,console.log(u),1!==u.code){s.next=32;break}if(0!==u.data.count){s.next=26;break}return r.address.isAllowUseInputAddress=!0,r.btnText="使用当前的输入地址",r.address.isNoSuggest=!0,r.address.suggestAddress=u.data.data,s.abrupt("return");case 26:r.address.isNoSuggest&&(r.address.isNoSuggest=!1),r.btnText="以上都不是, 以当前输入为准",r.address.suggestAddress=u.data.data,r.address.isAllowUseInputAddress=!0,s.next=33;break;case 32:console.error("查询失败");case 33:case"end":return s.stop()}}),s)})))()},debounceSearch:function(e){var r=this;console.log("debounce"),this.searchTimer&&(clearTimeout(this.searchTimer),this.searchTimer=null),this.searchTimer=setTimeout((function(){r.searchAddress(e),r.searchTimer=null}),1500)},pitchOnSuggestAddress:function(e){this.address.area.houseNum="";var r=e.title,s=e.address;this.address.area.detail=s+","+r,this.address.suggestAddress=[],this.address.isNoSuggest=this.address.isAllowUseInputAddress=!1,this.address.area.isShowPopup=!1,this.searchWord="",this.searchTimer&&(clearTimeout(this.searchTimer),this.searchTimer=null)},useCurInputAddress:function(){this.address.area.houseNum="",this.address.area.detail=this.searchWord,this.address.suggestAddress=[],this.address.isNoSuggest=this.address.isAllowUseInputAddress=!1,this.address.area.isShowPopup=!1,this.searchWord=""}})};r.default=l}).call(this,s("543d")["default"])},fb55:function(e,r,s){"use strict";s.r(r);var t=s("e553"),n=s.n(t);for(var a in t)["default"].indexOf(a)<0&&function(e){s.d(r,e,(function(){return t[e]}))}(a);r["default"]=n.a},fca2:function(e,r,s){}},[["5bdb","common/runtime","common/vendor"]]]);