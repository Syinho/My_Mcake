(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/Register/Register"],{1041:function(e,t,n){},"1f08":function(e,t,n){"use strict";n.d(t,"b",(function(){return c})),n.d(t,"c",(function(){return r})),n.d(t,"a",(function(){return o}));var o={"u-Input":function(){return Promise.all([n.e("common/vendor"),n.e("uni_modules/uview-ui/components/u--input/u--input")]).then(n.bind(null,"dc69"))},uniTransition:function(){return Promise.all([n.e("common/vendor"),n.e("uni_modules/uni-transition/components/uni-transition/uni-transition")]).then(n.bind(null,"9324"))},"u-Text":function(){return Promise.all([n.e("common/vendor"),n.e("uni_modules/uview-ui/components/u--text/u--text")]).then(n.bind(null,"206c"))},uText:function(){return Promise.all([n.e("common/vendor"),n.e("uni_modules/uview-ui/components/u-text/u-text")]).then(n.bind(null,"24e1"))},uCheckboxGroup:function(){return Promise.all([n.e("common/vendor"),n.e("uni_modules/uview-ui/components/u-checkbox-group/u-checkbox-group")]).then(n.bind(null,"d621"))},uCheckbox:function(){return Promise.all([n.e("common/vendor"),n.e("uni_modules/uview-ui/components/u-checkbox/u-checkbox")]).then(n.bind(null,"74b2"))},uToast:function(){return n.e("uni_modules/uview-ui/components/u-toast/u-toast").then(n.bind(null,"472c"))}},c=function(){var e=this,t=e.$createElement;e._self._c;e._isMounted||(e.e0=function(t){e.phoneChk=null},e.e1=function(t){e.captchaChk=null},e.e2=function(t){e.SMSChk=null},e.e3=function(t){e.pwdChk=null},e.e4=function(t){e.pwdSameChk=null})},r=[]},2823:function(e,t,n){"use strict";n.r(t);var o=n("5239"),c=n.n(o);for(var r in o)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return o[e]}))}(r);t["default"]=c.a},"38c6":function(e,t,n){"use strict";n.r(t);var o=n("1f08"),c=n("2823");for(var r in c)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return c[e]}))}(r);n("5356");var u=n("f0c5"),a=Object(u["a"])(c["default"],o["b"],o["c"],!1,null,null,null,!1,o["a"],void 0);t["default"]=a.exports},5239:function(e,t,n){"use strict";var o=n("4ea4");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var c=o(n("2eee")),r=o(n("c973")),u=o(n("9523")),a=n("1faf"),i=n("26cb");function h(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?h(Object(n),!0).forEach((function(t){(0,u.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):h(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var d={name:"register",data:function(){return{phone:"",captcha:"",captchaSrc:"",SMS:"",pwd:"",repeatPwd:"",checkboxValue:[],isAllowedSendText:!0,SMSBtnText:"获取短信验证码",isInCountDown:!1,captchaText:"",phoneChk:null,captchaChk:null,SMSChk:null,pwdChk:null,pwdSameChk:null,isChkCaptcha:!1}},computed:s(s({},(0,i.mapState)("user",{token:function(e){return e.token}})),{},{phoneChkIcon:function(){return null===this.phoneChk?"":1===this.phoneChk.code?"checkmark":0===this.phoneChk.code?"error":void 0},phoneChkIconStyle:function(){return null===this.phoneChk?"":1===this.phoneChk.code?{color:"#79D62E"}:0===this.phoneChk.code?{color:"#E63F31"}:void 0},captchaChkIcon:function(){return null===this.captchaChk?"":1===this.captchaChk.code?"checkmark":0===this.captchaChk.code?"error":void 0},captchaChkIconStyle:function(){return null===this.captchaChk?"":1===this.captchaChk.code?{color:"#79D62E"}:0===this.captchaChk.code?{color:"#E63F31"}:void 0},SMSChkIcon:function(){return null===this.SMSChk||1===this.SMSChk.code?"":0===this.SMSChk.code?"error":void 0},SMSChkIconStyle:function(){return null===this.SMSChk?"":1===this.SMSChk.code?{color:"#79D62E"}:0===this.SMSChk.code?{color:"#E63F31"}:void 0},pwdChkIcon:function(){return null===this.pwdChk?"":1===this.pwdChk.code?"checkmark":0===this.pwdChk.code?"error":void 0},pwdChkIconStyle:function(){return null===this.pwdChk?"":1===this.pwdChk.code?{color:"#79D62E"}:0===this.pwdChk.code?{color:"#E63F31"}:void 0},pwdSameChkIcon:function(){return null===this.pwdSameChk?"":1===this.pwdSameChk.code?"checkmark":0===this.pwdSameChk.code?"error":void 0},pwdSameChkIconStyle:function(){return null===this.pwdSameChk?"":1===this.pwdSameChk.code?{color:"#79D62E"}:0===this.pwdSameChk.code?{color:"#E63F31"}:void 0},captchaStyle:function(){return{backgroundImage:"url('".concat(this.captchaSrc,"')")}},isAgreedDeal:function(){return 0!==this.checkboxValue.length}}),onLoad:function(){this.updateCode()},methods:s(s(s(s({},(0,i.mapMutations)("user",["updatePhone","updateIsLogin"])),(0,i.mapMutations)("profile",["toggleRegisterSuccessToast"])),(0,i.mapActions)("user",["loginAndStorageUserData"])),{},{checkCaptcha:function(){return""===this.captcha?{code:0,text:"验证码输入框不可为空"}:this.captchaText!==this.captcha?{code:0,text:"输入的验证码与图片不相符"}:this.captchaText===this.captcha?{code:1}:void 0},checkPhone:function(){if(""===this.phone)return{code:0,text:"手机号码不可为空"};return/^\d{11}$/.test(this.phone)?{code:1}:{code:0,text:"手机号码必须是11位数字"}},checkSMS:function(){return""===this.SMS?{code:0,text:"短信验证码不可为空"}:{code:1}},checkPwd:function(){if(""===this.pwd)return{code:0,text:"密码不可为空"};return/^[a-zA-Z0-9]\w{7,19}$/g.test(this.pwd)?{code:1}:{code:0,text:"密码必须是8-20位的字母, 数字或下划线, 且首位不得是下划线"}},checkPwdSame:function(){return 0===this.pwdChk.code?this.pwdChk:""===this.repeatPwd?{code:0,text:"密码不可为空"}:this.pwd===this.repeatPwd?{code:1}:{code:0,text:"两次输入密码不一致"}},focus:function(e){null!==this[e+"Chk"]&&1!==this[e+"Chk"].code&&(this[e+"Chk"]=null)},updateCode:function(){var e=this;return(0,r.default)(c.default.mark((function t(){var n,o,r,u,i;return c.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,(0,a.reqImgCaptcha)().catch((function(e){return e}));case 2:n=t.sent,1===n.code&&(o=n.data,r=o.img,u=o.text,i=/#/g,e.captchaSrc="data:image/svg+xml;utf8,"+r.replace(i,"%23"),e.captchaText=u,console.log("%c register页面:updateCode函数向服务器发起请求获取到Captcha值为:","padding:5px 2px;color:yellow;background-color:#228B22;"),console.log(u));case 4:case"end":return t.stop()}}),t)})))()},getTextCode:function(){var e=this;return(0,r.default)(c.default.mark((function t(){var n,o;return c.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.isAllowedSendText){t.next=2;break}return t.abrupt("return");case 2:if(e.phoneChk=e.checkPhone(),e.captchaChk=e.checkCaptcha(),1===e.phoneChk.code&&1===e.captchaChk.code){t.next=7;break}return 0===e.captchaChk.code&&e.updateCode(),t.abrupt("return");case 7:return t.next=9,(0,a.reqTextCode)(e.phone,e.captcha).catch((function(e){return e}));case 9:n=t.sent,console.log(n),e.isAllowedSendText=!1,1===n.code?e.isChkCaptcha=!0:(e.captcha="",e.updateCode(),o={type:"error",message:n.msg},e.showToast(o),e.isAllowedSendText=!0);case 13:case"end":return t.stop()}}),t)})))()},showToast:function(e){this.$refs.uToast.show(s({},e))},register:function(){var e=this;return(0,r.default)(c.default.mark((function t(){var n,o,r,u,i,h,s,d,l,p;return c.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.phoneChk=e.checkPhone(),e.SMSChk=e.checkSMS(),e.pwdChk=e.checkPwd(),e.pwdSameChk=e.checkPwdSame(),e.isChkCaptcha){t.next=9;break}return console.error("register页面:检测到未发送短信验证码"),e.updateCode(),e.SMSChk={code:0,text:"您必须点击按钮接收短信注册码"},t.abrupt("return");case 9:if(1!==e.phoneChk.code||1!==e.SMSChk.code||1!==e.pwdChk.code||1!==e.pwdSameChk.code){t.next=12;break}t.next=14;break;case 12:return e.updateCode(),t.abrupt("return",e.$toast("error","请检查所填信息是否符合格式"));case 14:if(e.isAgreedDeal){t.next=16;break}return t.abrupt("return",e.$toast("default","请确认已同意购物协议"));case 16:return n=e.phone,o=e.pwd,r=e.SMS,t.next=19,(0,a.reqRegister)(n,o,r).catch((function(e){return e}));case 19:if(u=t.sent,console.log("%c register页面:执行注册逻辑, 向服务器发起请求, 获取到如下数据","padding:5px 2px;color:white;background-color:black;"),console.log(u),1!==u.code){t.next=36;break}return i=u.data,h=i.id,s=i.phone,d=i.token,e.loginAndStorageUserData({phone:s,id:h,type:"register"}),t.next=27,e.$setStorage("token",d);case 27:if(l=t.sent,0!==l.code){t.next=31;break}return p={type:"error",message:"储存token失败"},t.abrupt("return",e.showToast(p));case 31:e.updateIsLogin(!0),e.$switchPage({pageName:"Profile"}),e.toggleRegisterSuccessToast(!0),t.next=40;break;case 36:e.$toast("error",u.msg),e.isChkCaptcha=!1,e.SMS=e.captcha="",0===u.code&&"短信验证码错误"===u.msg&&(e.updateCode(),e.captcha=e.code="");case 40:case"end":return t.stop()}}),t)})))()}}),watch:{isAllowedSendText:function(e){var t=this,n=10,o=null;e?(o&&(clearInterval(o),o=null),this.SMSBtnText="获取短信验证码"):(this.SMSBtnText="倒计时10秒",o=setInterval((function(){n--,t.SMSBtnText="倒计时"+n+"秒",0===n&&(clearInterval(o),o=null,t.isAllowedSendText=!0)}),1e3))}}};t.default=d},5356:function(e,t,n){"use strict";var o=n("1041"),c=n.n(o);c.a},b007:function(e,t,n){"use strict";(function(e,t){var o=n("4ea4");n("0720");o(n("66fd"));var c=o(n("38c6"));e.__webpack_require_UNI_MP_PLUGIN__=n,t(c.default)}).call(this,n("bc2e")["default"],n("543d")["createPage"])}},[["b007","common/runtime","common/vendor"]]]);